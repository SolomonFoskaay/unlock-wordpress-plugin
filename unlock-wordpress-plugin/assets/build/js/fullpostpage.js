!function(){"use strict";var e={n:function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,{a:o}),o},d:function(t,o){for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.element,o=window.wp.i18n,r=window.wp.plugins,l=window.wp.editPost,n=window.wp.data,c=window.wp.compose,s=window.wp.components,a=window.React,u=window.wp.apiFetch,i=e.n(u);const d=(0,c.compose)([(0,n.withSelect)((e=>{const{getEditedPostAttribute:t}=e("core/editor");return{locks:t("unlockp_fullpp_locks")||[],ethereumNetworks:t("unlockp_fullpp_ethereumnetworks")||[]}})),(0,n.withDispatch)((e=>{const{editPost:t}=e("core/editor");return{onUpdateLocks:e=>t({unlockp_fullpp_locks:e}),onUpdateEthereumNetworks:e=>t({unlockp_fullpp_ethereumnetworks:e})}}))])((e=>{let{locks:r,ethereumNetworks:l,onUpdateLocks:c,onUpdateEthereumNetworks:u}=e;const[d,k]=(0,a.useState)(null),[p,m]=(0,a.useState)(!1),w=(0,n.useSelect)((e=>{const{getCurrentPostId:t}=e("core/editor");return{id:t()}}),[]),{isSavingPost:_,didPostSaveRequestSucceed:f}=(0,n.useSelect)((e=>{const{isSavingPost:t,didPostSaveRequestSucceed:o}=e("core/editor");return{isSavingPost:t(),didPostSaveRequestSucceed:o()}}),[]);(0,a.useEffect)((()=>{i()({path:"/unlock-protocol/v1/settings"}).then((e=>{let t=e.networks,r=[{label:(0,o.__)("None","unlock-protocol"),value:-1}];Object.entries(t).forEach((e=>{let[t,o]=e;r.push({label:o.network_name,value:o.network_id})})),u(r),(async e=>{try{const t=await i()({path:`/unlock-protocol/v1/get_unlockpfullpp_attributes?post_id=${e}`});t&&t.locks&&c(t.locks)}catch(e){console.error("Error fetching lock settings:",e)}})(w.id)})).catch((e=>{}))}),[w.id,p]),(0,a.useEffect)((()=>{!_&&f&&m(!p)}),[_,f,w.id]);const g=(e,t,o)=>{r[e][t]=o,c([...r])};return(0,t.createElement)("div",null,(0,t.createElement)(s.PanelBody,{title:(0,o.__)("Locks","unlock-protocol")},r.map(((e,n)=>(0,t.createElement)("div",{class:"setting-lock"},(0,t.createElement)(s.SelectControl,{label:(0,o.__)("Network","unlock-protocol"),value:e.network,options:l,onChange:e=>g(n,"network",parseInt(e))}),-1!==e.network?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",{className:"block-label"},(0,o.__)("Lock Address","unlock-protocol")),(0,t.createElement)(s.TextControl,{value:e.address,onChange:e=>g(n,"address",e)})):"",(0,t.createElement)(s.Button,{isSmall:!0,isDestructive:!0,onClick:()=>{(async e=>{r[e];try{const t=await(async(e,t)=>{try{return await i()({path:"/unlock-protocol/v1/delete_unlockpfullpp_attributes",method:"POST",data:{post_id:w.id,lock_index:t}})}catch(e){return console.error("Error deleting lock attributes:",e),{success:!1,message:e.message}}})(0,e);if(t&&t.success){const t=[...r];t.splice(e,1),c(t),m(!p),k("Lock deleted successfully")}else k(`Failed to delete lock. Error: ${t&&t.data&&t.data.message?t.data.message:"Unknown error"}`)}catch(e){console.error("Error deleting lock:",e),k(`Failed to delete lock. Error: ${e.message}`)}})(n)}},"Remove")))),(0,t.createElement)(s.PanelRow,null,(0,t.createElement)(s.Button,{className:"add-lock",variant:"primary",onClick:()=>{let e;e=r?[...r,{address:"",network:-1}]:[{address:"",network:-1}],c(e)}},"Add Lock"),(0,t.createElement)(s.Button,{className:"save-lock",variant:"primary",style:{backgroundColor:"green"},onClick:()=>(async(e,t)=>{const o=e.filter((e=>{return-1!==e.network&&e.address&&(t=e.address,/^0x[a-fA-F0-9]{40}$/.test(t));var t}));if(0===o.length)return void k("No valid lock(s) attributes to save.");const r={locks:o,ethereumNetworks:l};try{const e=await i()({path:"/unlock-protocol/v1/save_unlockpfullpp_attributes",method:"POST",data:{post_id:t,unlockpfullpp_attributes:JSON.stringify(r)}});if(e.success)k("Lock attributes saved successfully"),m(!p);else{const t=e.data;k(`Failed to save Lock attributes. Error: ${t.message||"Unknown error"}`)}}catch(e){k(`Catch Error: ${e.message||"Failed to save Lock attributes"}`)}})(r,w.id)},"Save Lock")),(0,t.createElement)(s.PanelRow,null,d&&(0,t.createElement)(s.Notice,{status:"Lock attributes saved successfully"===d?"success":"error",onRemove:()=>k(null)},d)),(0,t.createElement)("div",{className:"docs"},(0,t.createElement)("a",{rel:"noopener noreferrer",target:"_blank",href:unlockProtocol.unlock_docs.docs},(0,o.__)("Unlock's documentation","unlock-protocol")),(0,t.createElement)("br",null),(0,t.createElement)("a",{rel:"noopener noreferrer",target:"_blank",href:unlockProtocol.unlock_docs.deploy_lock},(0,o.__)("Deploy a lock","unlock-protocol")))))}));(0,r.registerPlugin)("unlock-protocol-unlock-box-fullpp",{render:()=>(0,t.createElement)(l.PluginDocumentSettingPanel,{name:"full-post-page-lock",title:(0,o.__)("Unlock Protocol","unlock-protocol")},(0,t.createElement)("p",null,(0,o.__)("Add lock(s) to restrict access to the full post/page content inside of WordPress.","unlock-protocol")),(0,t.createElement)(d,null))})}();